<!DOCTYPE html >
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Last month of tracks from both drifters and miniboats</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  #floating-panel {
        position: absolute;
        top: 10px;
        //left: 28%;
		left: 110px;
		//right: 10px;
        z-index: 5;
        background-color: #fff;
        padding: 6px;
        //border: 1px solid #999;
        text-align: center;
        //font-family: 'Roboto','sans-serif';
        line-height: 17px;
        padding-left: 10px;
		padding-right: 10px;
      }
    </style>
  </head>

  <body>
	<div id="floating-panel">
      <strong>Only</strong> the last month of drifter and miniboat tracks shown here (click <a href='http://nefsc.noaa.gov/drifter'>here</a> for more info)
    </div>
    <div id="map"></div>

    <script>
      /*var customLabel = {
        0: {
          label: 'I'
        },
        1: {
          label: 'A'
        }
      };*/
      var icons = {
        0: {
          icon: "./redmarker.png"
        },
        1: {
          icon: "./greenmarker.png"
        }
      };

        function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
				  center: new google.maps.LatLng(40.0, -62.0),
				  mapTypeId: 'satellite',
				  zoom: 5
				  });

          // Change this depending on the name of your PHP or XML file
          //downloadUrl('./drift_X.xml', function(data) {
		downloadUrl('drift_X.xml', function(data) {
              var xml = data.responseXML;
              var markers = xml.documentElement.getElementsByTagName('marker');
              Array.prototype.forEach.call(markers, function(markerElem) {
                  var id = markerElem.getAttribute('label');
                  var address = markerElem.getAttribute('html');
    
                  var type = markerElem.getAttribute('active');
                  var point = new google.maps.LatLng(
                      parseFloat(markerElem.getAttribute('lat')),
                      parseFloat(markerElem.getAttribute('lng')));
    
    			  var infowindows = new google.maps.InfoWindow({
    				 				content: address+'<br><strong>Note:</strong> <a href="http://www.nefsc.noaa.gov/drifter">More information.</a>'
    								});
                  //var icon = customLabel[type] || {};
                  var iconc =  icons[type] || {};
				  var image = {
					  url: iconc.icon,
					  //size: new google.maps.Size(71, 71),
					  origin: new google.maps.Point(0, 0),//Default origin is left-top of image.
					  anchor: new google.maps.Point(20, 40),
					  scaledSize: new google.maps.Size(40, 40)
					  };
                  var marker = new google.maps.Marker({
    						    map: map,
    						    position: point,
    						    //label: icon.label,
    						    icon: image,
    						    });
                  marker.addListener('click', function() {infowindows.open(map, marker);});
                  });
            // Polylines
            var lines = xml.documentElement.getElementsByTagName('line');
            Array.prototype.forEach.call(lines, function(lineplot) {
                var color = lineplot.getAttribute('color');
                 
                var points = lineplot.getElementsByTagName("point");
                var pathp = []
                for (i = 0; i <points.length; i++) {
                var point = new google.maps.LatLng(
                            parseFloat(points[i].getAttribute('lat')),
                            parseFloat(points[i].getAttribute('lng')));
                            pathp.push(point);
                            };
                
                var flightPath = new google.maps.Polyline({
                                path: pathp,
                                geodesic: true,
                                strokeColor: color,
                                strokeOpacity: 1.0,
                                strokeWeight: 2
                                });
                
                flightPath.setMap(map);
                });//end polylines

            });//end downloadURL
        }//end initMap

      function downloadUrl(url, callback) {
                var request = window.ActiveXObject ?
                new ActiveXObject('Microsoft.XMLHTTP') :
                new XMLHttpRequest;

                request.onreadystatechange = function() {
                                              if (request.readyState == 4) {
                                                    request.onreadystatechange = doNothing;
                                                    callback(request, request.status);
                                                    }
                                            };
                request.open('GET', url, true);
                request.send(null);
                }

      function doNothing() {}
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?v=3&client=gme-noaa&channel=NMFS.NEFSC.OCB.DRIFTERS&callback=initMap">
    </script>
    <!--
    <script  src="http://maps.googleapis.com/maps/api/js type="text/javascript">
    </script>
    -->
            
  </body>
</html>
